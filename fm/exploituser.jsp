<%@ page language="java" contentType="text/vnd.wap.wml;charset=UTF-8"%><%@ page import="java.util.List,net.joycool.wap.bean.PagingBean,net.joycool.wap.framework.BaseAction"%><%@ page import="jc.family.*"%><%!
	static String[] orders = {"con_fm desc", "alive desc", "visit_time desc"};
	static String[] levelNames = {"三天内", "三天前", "一周前", "一个月前", "三个月前"};
%><%
FamilyAction action=new FamilyAction(request,response);
FamilyUserBean fmUser=action.getFmUser();
if(fmUser==null){
response.sendRedirect("index.jsp");return;
}

int type = action.getParameterInt("type");
if(type<0||type>2) type=0;

FamilyHomeBean family = FamilyAction.getFmByID(fmUser.getFmId());
PagingBean paging= new PagingBean(action, family.getFm_member_num(), 10, "p");
List list =action.service.selectFmUserList(fmUser.getFm_id(), paging.getStartIndex(), paging.getCountPerPage(), " order by " + orders[type]);
int start=paging.getStartIndex();

%><?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD WML 1.1//EN" "http://www.wapforum.org/DTD/wml_1.1.xml">
<wml><card title="家人排名"><p align="left"><%=BaseAction.getTop(request, response)%>
<%if(type==0){%>功勋<%}else{%><a href="exploituser.jsp?type=0">功勋</a><%}%>|<%if(type==1){%>活跃点<%}else{%><a href="exploituser.jsp?type=1">活跃点</a><%}%>|<%if(type==2){%>回家<%}else{%><a href="exploituser.jsp?type=2">回家</a><%}%><br/>

<%
if(type==0) {

for(int i=0;i<list.size();i++){
FamilyUserBean bean=(FamilyUserBean)list.get(i);%>
<%=1+i+start%>.<a href="fmuserinfo.jsp?userid=<%=bean.getId()%>"><%=bean.getNickNameWml()%></a>|<%=bean.getCon_fm()%><br/><%}
%>

<%
}else if(type==1){


for(int i=0;i<list.size();i++){
FamilyUserBean bean=(FamilyUserBean)list.get(i);%>
<%=1+i+start%>.<a href="fmuserinfo.jsp?userid=<%=bean.getId()%>"><%=bean.getNickNameWml()%></a>|<%=bean.getAlive()%><br/><%}
%>

<%
}else if(type==2){

long now = System.currentTimeMillis();
for(int i=0;i<list.size();i++){
FamilyUserBean bean=(FamilyUserBean)list.get(i);
int day = (int)((now-bean.getVisitTime().getTime())/86400000);
int level;
if(day<3) level=0;
else if(day<7) level=1;
else if(day<30) level=2;
else if(day<90) level=3;
else level=4;
%><%=1+i+start%>.<a href="fmuserinfo.jsp?userid=<%=bean.getId()%>"><%=bean.getNickNameWml()%></a>|<%=levelNames[level]%><br/><%}
%>


<%}%>

<%=paging.shuzifenye("exploituser.jsp?type="+type,true, "|", response)%><br/>
<input name="userid" format="*N" maxlength="9"/>
<anchor title="搜索">
根据ID搜索
  <go href="fmuserinfo.jsp" method="post">
    <postfield name="userid" value="$(userid)"/>
  </go>
</anchor><br/>
&lt;<a href="myfamily.jsp">返回家族</a>&lt;<a href="index.jsp">家族首页</a><br/>
<%=BaseAction.getBottomShort(request,response)%></p></card></wml>